STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Fri May 10 11:49:31 2024
Page 1  Assembler
                                               c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm

   1                         stm8/     
   2                         
   0  000000                                 #include "mapping.inc"
   1                                                          ;-------------------------------
                                                                ;-----------------------
   2                                                          ; SEGMENT MAPPING FILE 
                                                                ;AUTOMATICALLY GENERATED BY 
                                                                ;STVD
   3                                                          ; SHOULD NOT BE MANUALLY 
                                                                ;MODIFIED.
   4                                                          ; CHANGES WILL BE LOST WHEN FILE
                                                                ; IS REGENERATED.
   5                                                          ;-------------------------------
                                                                ;-----------------------
   6  000000                                 #define  RAM0 1
   7  000000                                 #define  ram0_segment_start 0
   8  000000                                 #define  ram0_segment_end FF
   9  000000                                 #define  RAM1 1
  10  000000                                 #define  ram1_segment_start 100
  11  000000                                 #define  ram1_segment_end 5FF
  12  000000                                 #define  stack_segment_start 600
  13  000000                                 #define  stack_segment_end 7FF
<END_OF_INCLUSION>
   4                                   segment  'ram0'
   5  000000                       index     ds.w                   ; already cleared to 0 so no 
                                                                ;need for setup.
   6  000002                       sum       ds.b                   ; same here
   7  000003                       average_result  ds.b                   ; same here.
   8  000004                       remainder  ds.b     
   9                         
  10                                   segment  'rom'
  11  008080   F0020410            list      dc.b     $F0, $02, $04, $10
  12  008084   40580000            list_signed  dc.b     64, 88, 0, 0
  13  008088   0004                LIST_COUNT  DC.W     4
  14  00808A   04                  DIVISOR   DC.B     4
  15                         
  16                         main.l    
  17                                                          ; initialize SP
  18  00808B   AE07FF                        ldw      X,#stack_end
  19  00808E   94                            ldw      SP,X
  20                         
  21  00808F                                 #ifdef   1             
  22                                                          ; clear RAM0
  23  000000                       ram0_start.b  EQU      $0
  24  0000FF                       ram0_end.b  EQU      $FF
  25  00808F   AE0000                        ldw      X,#ram0_start
  26                         clear_ram0.l  
  27  008092   7F                            clr      (X)
  28  008093   5C                            incw     X
  29  008094   A300FF                        cpw      X,#ram0_end   
  30  008097   23F9                          jrule    clear_ram0
  31  008099                                 #endif   
  32                         
  33  008099                                 #ifdef   1
  34                                                          ; clear RAM1
  35  000100                       ram1_start.w  EQU      $100
  36  0005FF                       ram1_end.w  EQU      $5FF          
  37  008099   AE0100                        ldw      X,#ram1_start
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Fri May 10 11:49:31 2024
Page 2  Assembler
                                               c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm

  38                         clear_ram1.l  
  39  00809C   7F                            clr      (X)
  40  00809D   5C                            incw     X
  41  00809E   A305FF                        cpw      X,#ram1_end   
  42  0080A1   23F9                          jrule    clear_ram1
  43  0080A3                                 #endif   
  44                         
  45                                                          ; clear stack
  46  000600                       stack_start.w  EQU      $600
  47  0007FF                       stack_end.w  EQU      $7FF
  48  0080A3   AE0600                        ldw      X,#stack_start
  49                         clear_stack.l  
  50  0080A6   7F                            clr      (X)
  51  0080A7   5C                            incw     X
  52  0080A8   A307FF                        cpw      X,#stack_end  
  53  0080AB   23F9                          jrule    clear_stack
  54                         
  55                         infinite_loop.l  
  56  0080AD   CD80D7                        call     calculate_average
  57  0080B0   CD8113                        call     calculate_average_signed
  58                         calc_done  
  59  0080B3   20FE                          jra      calc_done
  60                         
  61                         calculate_sum  
  62                                                          ; fetching value
  63  0080B5   CE0000                        ldw      X, index
  64  0080B8   D68080                        ld       A, (list,X)
  65                                                          ; doing and storing addition
  66  0080BB   CB0002                        ADD      A, sum
  67                                                          ; checking whether overflow is 
                                                                ;present w C bit
  68  0080BE   2407                          jrnc     no_carry
  69                                                          ; if carry(i.e. overflow 
                                                                ;present) move FF to average 
                                                                ;result.
  70  0080C0   35FF0003                      MOV      average_result, #$FF
  71  0080C4   CC80D6                        jp       sum_done
  72                         no_carry  
  73  0080C7   C70002                        ld       sum, A
  74  0080CA   5C                            incw     X
  75  0080CB   CF0000                        ldw      index, X
  76  0080CE   C38088                        cpw      X, LIST_COUNT
  77  0080D1   2703                          jreq     sum_done
  78  0080D3   CC80B5                        jp       calculate_sum
  79                         sum_done  
  80  0080D6   81                            ret      
  81                                   
  82                         calculate_average  
  83                                                          ; get sum
  84  0080D7   CD80B5                        call     calculate_sum
  85                                                          ; check whether carry was 
                                                                ;present.
  86  0080DA   C60003                        ld       A, average_result
  87  0080DD   A1FF                          cp       A, #$FF
  88  0080DF   270F                          jreq     carry_present
  89                                                          ; do division
  90  0080E1   C60002                        ld       A, sum
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Fri May 10 11:49:31 2024
Page 3  Assembler
                                               c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm

  91  0080E4   97                            ld       XL, A
  92  0080E5   C6808A                        ld       A, DIVISOR
  93  0080E8   62                            div      X, A
  94  0080E9   C70004                        ld       remainder, A
  95  0080EC   9F                            ld       A, XL
  96  0080ED   C70003                        ld       average_result, A
  97                         carry_present  
  98  0080F0   81                            ret      
  99                                   
 100                         calculate_sum_signed             ;differnet list so other func 
                                                                ;required!
 101                                                          ; fetching value
 102  0080F1   CE0000                        ldw      X, index
 103  0080F4   D68084                        ld       A, (list_signed,X)
 104                                                          ; doing and storing addition
 105  0080F7   CB0002                        ADD      A, sum
 106                                                          ; checking for overflow present
 107  0080FA   2807                          jrnv     no_overflow_signed
 108                                                          ; if overflow present move FF to
                                                                ; average result and be done
 109  0080FC   35FF0003                      MOV      average_result, #$FF
 110  008100   CC8112                        jp       sum_done_signed
 111                         no_overflow_signed  
 112  008103   C70002                        ld       sum, A
 113  008106   5C                            incw     X
 114  008107   CF0000                        ldw      index, X
 115  00810A   C38088                        cpw      X, LIST_COUNT
 116  00810D   2703                          jreq     sum_done_signed
 117  00810F   CC80F1                        jp       calculate_sum_signed
 118                         sum_done_signed  
 119  008112   81                            ret      
 120                                   
 121                         
 122                         
 123                         calculate_average_signed  
 124  008113   AE0000                        ldw      X, #0
 125  008116   CF0000                        ldw      index, X      ; reset index
 126  008119   35000002                      MOV      sum, #0       ; reset sum.
 127  00811D   CD80F1                        call     calculate_sum_signed
 128                                                          ; check for overflow to skip 
                                                                ;division
 129  008120   C60003                        ld       A, average_result
 130  008123   A1FF                          cp       A, #$FF
 131  008125   2708                          jreq     overflow_present_signed
 132                                                          ; do division
 133  008127   C60002                        ld       A, sum
 134  00812A   47                            sra      A
 135  00812B   47                            sra      A
 136  00812C   C70003                        ld       average_result, A
 137                         overflow_present_signed  
 138  00812F   81                            ret      
 139                                   
 140  008130                                 interrupt NonHandledInterrupt
 141                         NonHandledInterrupt.l  
 142  008130   80                            iret     
 143                         
 144                         
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Fri May 10 11:49:31 2024
Page 4  Assembler
                                               c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm

 145                                   segment  'vectit'
 146  008000   8200808B                      dc.l     {$82000000+main}  ; reset
 147  008004   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; trap
 148  008008   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq0
 149  00800C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq1
 150  008010   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq2
 151  008014   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq3
 152  008018   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq4
 153  00801C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq5
 154  008020   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq6
 155  008024   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq7
 156  008028   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq8
 157  00802C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq9
 158  008030   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq10
 159  008034   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq11
 160  008038   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq12
 161  00803C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq13
 162  008040   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq14
 163  008044   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq15
 164  008048   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq16
 165  00804C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq17
 166  008050   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq18
 167  008054   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq19
 168  008058   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq20
 169  00805C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq21
 170  008060   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq22
 171  008064   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq23
 172  008068   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq24
 173  00806C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq25
 174  008070   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq26
 175  008074   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq27
 176  008078   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq28
 177  00807C   82008130                      dc.l     {$82000000+NonHandledInterrupt}  ; irq29
 178                         
 179  008080                                 end      
STMicroelectronics list file postprocessor v1.01   (C)2009-2024   Fri May 10 11:49:31 2024
Page 5  Assembler
                                               c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm

Symbol Name                       Value     Call       Type  Scope      Rel.  Line  Privacy  Segment   Size  Bytes File

DIVISOR                               808A         no  WORD  Internal   ABS     14  private  textdata     1     1  -

LIST_COUNT                            8088         no  WORD  Internal   ABS     13  private  textdata     2     2  -

NonHandledInterrupt               00008130  interrupt  LONG  Internal   ABS    141  private  textdata     1     0  -

average_result                        0003         no  WORD  Internal   ABS      7  private  bss          1     1  -

clear_ram0                        00008092         no  LONG  Internal   ABS     26  private  textdata    10     0  -
clear_ram1                        0000809C         no  LONG  Internal   ABS     38  private  textdata    10     0  -
clear_stack                       000080A6         no  LONG  Internal   ABS     49  private  textdata     7     0  -
calc_done                             80B3         no  WORD  Internal   ABS     58  private  textdata     2     0  -
calculate_sum                         80B5         no  WORD  Internal   ABS     61  private  textdata    18     0  -
calculate_average                     80D7         no  WORD  Internal   ABS     82  private  textdata    25     0  -
carry_present                         80F0         no  WORD  Internal   ABS     97  private  textdata     1     0  -
calculate_sum_signed                  80F1         no  WORD  Internal   ABS    100  private  textdata    18     0  -
calculate_average_signed              8113         no  WORD  Internal   ABS    123  private  textdata    28     0  -

index                                 0000         no  WORD  Internal   ABS      5  private  bss          2     2  -
infinite_loop                     000080AD         no  LONG  Internal   ABS     55  private  textdata     6     0  -

list                                  8080         no  WORD  Internal   ABS     11  private  textdata     4     1  -
list_signed                           8084         no  WORD  Internal   ABS     12  private  textdata     4     1  -

main                              0000808B         no  LONG  Internal   ABS     16  private  textdata     7     0  -

no_carry                              80C7         no  WORD  Internal   ABS     72  private  textdata    15     0  -
no_overflow_signed                    8103         no  WORD  Internal   ABS    111  private  textdata    15     0  -

overflow_present_signed               812F         no  WORD  Internal   ABS    137  private  textdata     1     0  -

remainder                             0004         no  WORD  Internal   ABS      8  private  bss          1     1  -
ram0_start                              00         no  BYTE  Internal   ABS     23  private  textdata     0     0  -
ram0_end                                FF         no  BYTE  Internal   ABS     24  private  textdata     0     0  -
ram1_start                            0100         no  WORD  Internal   ABS     35  private  textdata     0     0  -
ram1_end                              05FF         no  WORD  Internal   ABS     36  private  textdata     0     0  -

sum                                   0002         no  WORD  Internal   ABS      6  private  bss          1     1  -
stack_start                           0600         no  WORD  Internal   ABS     46  private  textdata     0     0  -
stack_end                             07FF         no  WORD  Internal   ABS     47  private  textdata     0     0  -
sum_done                              80D6         no  WORD  Internal   ABS     79  private  textdata     1     0  -
sum_done_signed                       8112         no  WORD  Internal   ABS    118  private  textdata     1     0  -


31 labels
No errors on assembly of 'c:\users\simeo\qsync\university\computer architectures\lab5_exam\ex3_2nd.asm'